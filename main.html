<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LC Date Calculator Pro</title>
<style>
/* ===== ENHANCED DESIGN ===== */
:root {
  --primary: #4361ee;
  --primary-light: #4895ef;
  --primary-dark: #3a0ca3;
  --secondary: #7209b7;
  --accent: #f72585;
  --success: #4cc9f0;
  --light: #f8f9fa;
  --dark: #212529;
  --gray: #6c757d;
  --light-gray: #e9ecef;
  --card-bg: rgba(255, 255, 255, 0.95);
  --card-border: rgba(67, 97, 238, 0.15);
  --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  --radius: 16px;
}

.dark-theme {
  --light: #121212;
  --dark: #f8f9fa;
  --gray: #adb5bd;
  --light-gray: #2d3436;
  --card-bg: rgba(30, 30, 30, 0.95);
  --card-border: rgba(67, 97, 238, 0.25);
  --shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: var(--dark);
  min-height: 100vh;
  transition: all 0.3s ease;
  padding: 20px;
}

.dark-theme body {
  background: linear-gradient(135deg, #121212 0%, #2d3436 100%);
}

/* Container */
.main-container {
  max-width: 520px;
  margin: 0 auto;
  background: var(--card-bg);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  border: 1px solid var(--card-border);
  overflow: hidden;
  animation: slideUp 0.5s ease-out;
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Header */
.app-header {
  padding: 30px 30px 20px;
  text-align: center;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  color: white;
  position: relative;
}

.app-header::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 10%;
  width: 80%;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
}

.app-title {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
  letter-spacing: -0.5px;
}

.app-subtitle {
  font-size: 14px;
  opacity: 0.9;
  font-weight: 400;
}

/* User Info */
.user-info-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 30px;
  background: var(--light-gray);
  border-bottom: 1px solid var(--card-border);
}

.user-greeting {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 500;
}

.user-greeting span {
  color: var(--primary);
}

.logout-btn {
  padding: 8px 20px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 25px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.logout-btn:hover {
  background: #d63384;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(247, 37, 133, 0.3);
}

/* Content */
.content {
  padding: 30px;
}

/* Section Titles */
.section-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--light-gray);
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title::before {
  content: 'â–¶';
  font-size: 12px;
  color: var(--accent);
}

/* Input Groups */
.input-group {
  margin-bottom: 25px;
}

.input-label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: var(--gray);
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.input-field {
  width: 100%;
  padding: 15px 20px;
  background: var(--light-gray);
  border: 2px solid transparent;
  border-radius: 12px;
  font-size: 16px;
  color: var(--dark);
  transition: all 0.3s ease;
  outline: none;
}

.input-field:focus {
  border-color: var(--primary);
  background: white;
  box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
}

.dark-theme .input-field:focus {
  background: #1a1a1a;
}

/* Results */
.results-grid {
  display: grid;
  gap: 15px;
  margin: 25px 0;
}

.result-card {
  background: var(--light-gray);
  border-radius: 12px;
  padding: 20px;
  border-left: 4px solid var(--primary);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.result-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
}

.result-card.secondary {
  border-left-color: var(--secondary);
}

.result-card.accent {
  border-left-color: var(--accent);
}

.result-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--gray);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}

.result-value {
  font-size: 24px;
  font-weight: 700;
  color: var(--primary);
}

.result-card.secondary .result-value {
  color: var(--secondary);
}

.result-card.accent .result-value {
  color: var(--accent);
}

/* Converter Section */
.converter-section {
  margin-top: 40px;
  padding-top: 30px;
  border-top: 2px solid var(--light-gray);
}

.currency-selector {
  margin-top: 15px;
}

.currency-selector select {
  background: var(--light-gray);
  border: 2px solid transparent;
  border-radius: 12px;
  padding: 15px;
  width: 100%;
  font-size: 16px;
  color: var(--dark);
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%234361ee' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 15px center;
  background-size: 12px;
}

.currency-selector select:focus {
  border-color: var(--primary);
  outline: none;
}

/* Quick Actions */
.quick-actions {
  display: flex;
  gap: 12px;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid var(--light-gray);
}

.action-btn {
  flex: 1;
  padding: 14px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
}

.action-btn.game {
  background: linear-gradient(135deg, #4cc9f0, #4361ee);
}

.action-btn.export {
  background: linear-gradient(135deg, #f72585, #7209b7);
}

/* Footer */
.app-footer {
  text-align: center;
  padding: 25px 30px;
  background: var(--light-gray);
  border-top: 1px solid var(--card-border);
}

.creator-badge {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 12px 30px;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: white;
  border-radius: 25px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.creator-badge:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 10px 25px rgba(247, 37, 133, 0.4);
}

/* Theme Toggle */
.theme-toggle-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--shadow);
  z-index: 1000;
  transition: all 0.3s ease;
  border: 2px solid var(--primary);
}

.dark-theme .theme-toggle-btn {
  background: #2d3436;
  color: white;
}

.theme-toggle-btn:hover {
  transform: rotate(30deg) scale(1.1);
}

/* Notification */
.notification {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--card-bg);
  color: var(--dark);
  padding: 15px 25px;
  border-radius: 12px;
  box-shadow: var(--shadow);
  border-left: 4px solid var(--success);
  transform: translateX(150%);
  transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  z-index: 1000;
  max-width: 350px;
}

.notification.show {
  transform: translateX(0);
}

/* Game and Export Containers */
.modal-container {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(5px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal-container.show {
  display: flex;
}

.modal-window {
  background: var(--card-bg);
  border-radius: var(--radius);
  padding: 30px;
  max-width: 450px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
  animation: scaleIn 0.3s ease;
}

@keyframes scaleIn {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid var(--light-gray);
}

.modal-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--primary);
}

.close-btn {
  background: none;
  border: none;
  font-size: 28px;
  color: var(--gray);
  cursor: pointer;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.close-btn:hover {
  background: var(--light-gray);
  color: var(--accent);
}

/* Hidden State */
.hidden {
  display: none;
}

.opacity-hidden {
  opacity: 0;
  height: 0;
  overflow: hidden;
  margin: 0;
  padding: 0;
  transition: all 0.3s ease;
}

/* Responsive */
@media (max-width: 600px) {
  body {
    padding: 10px;
  }
  
  .main-container {
    border-radius: 12px;
  }
  
  .content {
    padding: 20px;
  }
  
  .app-header {
    padding: 25px 20px 15px;
  }
  
  .app-title {
    font-size: 24px;
  }
  
  .theme-toggle-btn {
    top: 15px;
    right: 15px;
    width: 45px;
    height: 45px;
  }
  
  .quick-actions {
    flex-direction: column;
  }
  
  .result-value {
    font-size: 20px;
  }
}

/* Game-specific */
.game-canvas {
  width: 100%;
  height: 300px;
  background: var(--light-gray);
  border-radius: 12px;
  margin: 20px 0;
  border: 2px solid var(--card-border);
}

/* Export Options */
.export-options {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin: 20px 0;
}

.export-option {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 15px;
  background: var(--light-gray);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.export-option:hover {
  background: rgba(67, 97, 238, 0.1);
  transform: translateX(5px);
}

.export-option input {
  accent-color: var(--primary);
}

.export-option label {
  flex: 1;
  font-weight: 500;
  cursor: pointer;
}

.export-btn {
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 20px;
}

.export-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(247, 37, 133, 0.3);
}
</style>
</head>
<body>

<!-- Theme Toggle -->
<button class="theme-toggle-btn" onclick="toggleTheme()">ðŸŒ“</button>

<!-- Main Container -->
<div class="main-container">
  <!-- Header -->
  <header class="app-header">
    <h1 class="app-title">LC Date Calculator Pro</h1>
    <p class="app-subtitle">Advanced Calculations Made Simple</p>
  </header>

  <!-- User Info -->
  <div class="user-info-bar">
    <div class="user-greeting">
      <span>ðŸ‘¤</span>
      <span id="currentUser">Welcome, User</span>
    </div>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <!-- Main Content -->
  <div class="content">
    <!-- Date Calculation Section -->
    <h2 class="section-title">Date Calculations</h2>
    
    <div class="input-group">
      <label class="input-label">LC Issuance Date</label>
      <input type="date" class="input-field" id="inputDate" onchange="calculateAll()">
    </div>

    <div class="input-group">
      <label class="input-label">Days to Subtract</label>
      <input type="number" class="input-field" id="subDays" placeholder="Enter days (e.g., 21)" 
             min="0" max="90" oninput="calculateAll()">
    </div>

    <!-- Results -->
    <div class="results-grid">
      <div class="result-card opacity-hidden" id="date90Card">
        <div class="result-label">90-Day Expiry Date</div>
        <div class="result-value" id="date90">--/--/----</div>
      </div>

      <div class="result-card secondary opacity-hidden" id="finalDateCard">
        <div class="result-label">Latest Shipment Date</div>
        <div class="result-value" id="finalDate">--/--/----</div>
      </div>
    </div>

    <!-- Converter Section -->
    <section class="converter-section">
      <h2 class="section-title">Number to Words Converter</h2>
      
      <div class="input-group">
        <label class="input-label">Amount to Convert</label>
        <input type="number" class="input-field" id="numberInput" 
               placeholder="Enter amount (e.g., 6521.11)" step="0.01" oninput="convertNumberToWords()">
      </div>

      <div class="input-group currency-selector">
        <label class="input-label">Currency</label>
        <select id="currencySelect" onchange="convertNumberToWords()">
          <option value="USD">USD (Dollars/Cents)</option>
          <option value="GBP">GBP (Pounds/Pence)</option>
          <option value="EUR">EUR (Euros/Cents)</option>
          <option value="AUD">AUD (Dollars/Cents)</option>
          <option value="CAD">CAD (Dollars/Cents)</option>
          <option value="JPY">JPY (Yen)</option>
          <option value="CNY">CNY (Yuan/Fen)</option>
          <option value="INR">INR (Rupees/Paise)</option>
        </select>
      </div>

      <div class="result-card accent opacity-hidden" id="wordsOutputCard">
        <div class="result-label">Amount in Words</div>
        <div class="result-value" id="wordsOutput">--</div>
      </div>
    </section>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button class="action-btn game" onclick="showGame()">
        <span>ðŸŽ®</span>
        <span>Game</span>
      </button>
      <button class="action-btn export" onclick="showExport()">
        <span>ðŸ“¤</span>
        <span>Export</span>
      </button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="app-footer">
    <div class="creator-badge" onclick="animateCreatorBadge()">
      <span>ðŸ‘‘</span>
      <span>Created by Sethil</span>
    </div>
  </footer>
</div>

<!-- Game Modal -->
<div class="modal-container" id="gameContainer">
  <div class="modal-window">
    <div class="modal-header">
      <h2 class="modal-title">ðŸš¢ Ship Game</h2>
      <button class="close-btn" onclick="hideGame()">Ã—</button>
    </div>
    <div class="game-content">
      <div class="game-canvas" id="gameCanvasContainer">
        <canvas id="gameCanvas" width="400" height="300"></canvas>
      </div>
      <div class="game-stats" style="display: flex; justify-content: space-around; margin: 20px 0;">
        <div style="text-align: center;">
          <div style="font-size: 24px; font-weight: 700; color: var(--primary);" id="scoreValue">0</div>
          <div style="font-size: 12px; color: var(--gray);">SCORE</div>
        </div>
        <div style="text-align: center;">
          <div style="font-size: 24px; font-weight: 700; color: var(--secondary);" id="highScoreValue">0</div>
          <div style="font-size: 12px; color: var(--gray);">HIGH SCORE</div>
        </div>
      </div>
      <div style="text-align: center;">
        <button class="action-btn" onclick="startGame()" style="margin: 10px;">Start Game</button>
        <button class="logout-btn" onclick="pauseGame()" style="margin: 10px;">Pause</button>
      </div>
      <p style="text-align: center; color: var(--gray); margin-top: 20px; font-size: 14px;">
        Use arrow keys to control the ship
      </p>
    </div>
  </div>
</div>

<!-- Export Modal -->
<div class="modal-container" id="exportContainer">
  <div class="modal-window">
    <div class="modal-header">
      <h2 class="modal-title">ðŸ“¤ Export Results</h2>
      <button class="close-btn" onclick="hideExport()">Ã—</button>
    </div>
    <div class="export-options">
      <div class="export-option">
        <input type="checkbox" id="exportDate90" checked>
        <label for="exportDate90">90-Day Expiry Date</label>
      </div>
      <div class="export-option">
        <input type="checkbox" id="exportFinalDate" checked>
        <label for="exportFinalDate">Latest Shipment Date</label>
      </div>
      <div class="export-option">
        <input type="checkbox" id="exportNumberWords" checked>
        <label for="exportNumberWords">Number to Words Conversion</label>
      </div>
      <div class="export-option">
        <input type="checkbox" id="exportInputData" checked>
        <label for="exportInputData">Input Data</label>
      </div>
    </div>
    <div style="margin: 20px 0;">
      <h3 style="color: var(--primary); margin-bottom: 15px; font-size: 16px;">Export Format</h3>
      <div class="export-options">
        <div class="export-option">
          <input type="radio" id="exportText" name="exportFormat" value="text" checked>
          <label for="exportText">Text File (.txt)</label>
        </div>
        <div class="export-option">
          <input type="radio" id="exportPrint" name="exportFormat" value="print">
          <label for="exportPrint">Print Preview</label>
        </div>
      </div>
    </div>
    <button class="export-btn" onclick="exportResults()">Export Now</button>
  </div>
</div>

<!-- Notification -->
<div class="notification" id="notification">
  <div id="notificationText">Welcome to LC Calculator Pro!</div>
</div>

<!-- Keep ALL your original JavaScript exactly as it was -->
<script>
// ===== ENHANCED USER TRACKING FOR ALL USERS =====
function getCurrentUser() {
    return {
        id: localStorage.getItem('currentUserId') || generateUserId(),
        name: localStorage.getItem('currentUserName') || 'Guest',
        loginTime: localStorage.getItem('currentLoginTime') || new Date().toISOString()
    };
}

function generateUserId() {
    const id = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    localStorage.setItem('currentUserId', id);
    return id;
}

function trackUserAction(action, details = {}) {
    const currentUser = getCurrentUser();
    const actionData = {
        id: generateActionId(),
        userId: currentUser.id,
        userName: currentUser.name,
        action: action,
        timestamp: new Date().toISOString(),
        details: details
    };
    
    console.log('ðŸŽ¯ USER ACTION TRACKED:', actionData);
    
    const allUserActions = JSON.parse(localStorage.getItem('allUserActions') || '[]');
    allUserActions.push(actionData);
    localStorage.setItem('allUserActions', JSON.stringify(allUserActions));
    
    updateUserLastActivity(currentUser.id);
}

function trackPageView() {
    const currentUser = getCurrentUser();
    const pageView = {
        id: generateActionId(),
        userId: currentUser.id,
        userName: currentUser.name,
        page: 'main.html',
        timestamp: new Date().toISOString(),
        referrer: document.referrer || 'Direct visit'
    };
    
    const allPageViews = JSON.parse(localStorage.getItem('allPageViews') || '[]');
    allPageViews.push(pageView);
    localStorage.setItem('allPageViews', JSON.stringify(allPageViews));
}

function updateUserLastActivity(userId) {
    const allUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
    const userIndex = allUsers.findIndex(user => user.id === userId);
    
    if (userIndex !== -1) {
        allUsers[userIndex].lastActivity = new Date().toISOString();
        localStorage.setItem('allUsers', JSON.stringify(allUsers));
    }
}

function generateActionId() {
    return 'action_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
}

function checkLogin() {
    const userName = localStorage.getItem('currentUserName');
    if (!userName) {
        window.location.href = 'login.html';
        return;
    }
    document.getElementById('currentUser').textContent = `Welcome, ${userName}`;
    trackUserSession();
}

function trackUserSession() {
    const currentUser = getCurrentUser();
    trackPageView();
    showWelcomeMessage();
}

function logout() {
    const currentUser = getCurrentUser();
    trackUserAction('user_logout', {
        logoutTime: new Date().toISOString()
    });
    
    localStorage.removeItem('currentUserName');
    localStorage.removeItem('currentLoginTime');
    localStorage.removeItem('currentUserId');
    
    window.location.href = 'index.html';
}

function showWelcomeMessage() {
    const userName = localStorage.getItem('currentUserName') || 'Guest';
    setTimeout(() => {
        showNotification(`Welcome ${userName} to LC Date Calculator Pro!`);
    }, 1000);
}

function showAdmin() {
    trackUserAction('admin_access_attempted');
    window.location.href = 'admin.html';
}

// Theme Toggle
function toggleTheme() {
    document.body.classList.toggle('dark-theme');
    const btn = document.querySelector('.theme-toggle-btn');
    btn.textContent = document.body.classList.contains('dark-theme') ? 'â˜€ï¸' : 'ðŸŒ™';
    localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
    trackUserAction('theme_toggled');
}

function detectSystemTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.body.classList.add('dark-theme');
        document.querySelector('.theme-toggle-btn').textContent = 'â˜€ï¸';
    }
}

// Notification
function showNotification(message) {
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');
    
    notificationText.textContent = message;
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3000);
}

// Animations
function animateCreatorBadge() {
    const badge = document.querySelector('.creator-badge');
    badge.style.animation = 'none';
    setTimeout(() => {
        badge.style.animation = 'pulse 0.8s ease';
    }, 10);
    showNotification('Thank you for using LC Calculator Pro!');
}

// Show/Hide Elements
function showElement(element) {
    element.classList.remove('opacity-hidden');
}

function hideElement(element) {
    element.classList.add('opacity-hidden');
}

// Main calculation function
function calculateAll() {
    trackUserAction('date_calculation', {
        inputDate: document.getElementById('inputDate').value,
        daysToSubtract: document.getElementById('subDays').value
    });
    
    const inputDate = document.getElementById('inputDate').value;
    const daysToSubtract = parseInt(document.getElementById('subDays').value) || 0;
    
    const date90Card = document.getElementById('date90Card');
    const finalDateCard = document.getElementById('finalDateCard');
    
    if (inputDate) {
        const parts = inputDate.split('-');
        const date90 = new Date(parts[0], parts[1]-1, parts[2]);
        date90.setDate(date90.getDate() + 90);
        document.getElementById('date90').textContent = formatDate(date90);
        showElement(date90Card);
        
        if (!isNaN(daysToSubtract) && daysToSubtract > 0) {
            const finalDate = new Date(date90);
            finalDate.setDate(finalDate.getDate() - daysToSubtract);
            document.getElementById('finalDate').textContent = formatDate(finalDate);
            showElement(finalDateCard);
        } else {
            hideElement(finalDateCard);
        }
    } else {
        hideElement(date90Card);
        hideElement(finalDateCard);
    }
}

function formatDate(date) {
    const day = date.getDate().toString().padStart(2, '0');
    const month = (date.getMonth()+1).toString().padStart(2, '0');
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
}

// Number to words converter
function convertNumberToWords() {
    trackUserAction('number_conversion', {
        number: document.getElementById('numberInput').value,
        currency: document.getElementById('currencySelect').value
    });
    
    const numberStr = document.getElementById('numberInput').value;
    const currency = document.getElementById('currencySelect').value;
    const wordsOutputCard = document.getElementById('wordsOutputCard');
    
    if (!numberStr) {
        hideElement(wordsOutputCard);
        return;
    }
    
    const words = numberToWords(numberStr, currency);
    document.getElementById('wordsOutput').textContent = words || 'ZERO';
    showElement(wordsOutputCard);
}

function numberToWords(numberStr, currency) {
    if (!numberStr) return '';
    
    const currencyUnits = getCurrencyUnits(currency);
    
    const parts = numberStr.toString().split('.');
    let wholePart = parts[0];
    let decimalPart = parts.length > 1 ? parts[1] : '';
    
    if (currency === 'JPY') {
        decimalPart = '';
    }
    
    let words = convertWholeNumber(wholePart);
    
    if (words) {
        words += ' ' + (parseInt(wholePart) === 1 ? currencyUnits.whole.singular : currencyUnits.whole.plural);
    } else {
        words = 'ZERO ' + currencyUnits.whole.plural;
    }
    
    if (decimalPart && decimalPart.length > 0 && currency !== 'JPY') {
        if (decimalPart.length === 1) decimalPart += '0';
        decimalPart = decimalPart.substring(0, 2);
        
        const decimalValue = parseInt(decimalPart);
        if (decimalValue > 0) {
            const decimalWords = convertWholeNumber(decimalPart);
            if (decimalWords) {
                words += ' AND ' + decimalWords;
                words += ' ' + (decimalValue === 1 ? currencyUnits.fraction.singular : currencyUnits.fraction.plural);
            }
        }
    }
    
    return words;
}

function getCurrencyUnits(currency) {
    const currencies = {
        USD: { whole: { singular: 'DOLLAR', plural: 'DOLLARS' }, fraction: { singular: 'CENT', plural: 'CENTS' } },
        GBP: { whole: { singular: 'POUND', plural: 'POUNDS' }, fraction: { singular: 'PENCE', plural: 'PENCE' } },
        AUD: { whole: { singular: 'DOLLAR', plural: 'DOLLARS' }, fraction: { singular: 'CENT', plural: 'CENTS' } },
        EUR: { whole: { singular: 'EURO', plural: 'EUROS' }, fraction: { singular: 'CENT', plural: 'CENTS' } },
        CAD: { whole: { singular: 'DOLLAR', plural: 'DOLLARS' }, fraction: { singular: 'CENT', plural: 'CENTS' } },
        THB: { whole: { singular: 'BAHT', plural: 'BAHT' }, fraction: { singular: 'SATANG', plural: 'SATANG' } },
        JPY: { whole: { singular: 'YEN', plural: 'YEN' }, fraction: { singular: '', plural: '' } },
        CNY: { whole: { singular: 'YUAN', plural: 'YUAN' }, fraction: { singular: 'FEN', plural: 'FEN' } },
        INR: { whole: { singular: 'RUPEE', plural: 'RUPEE' }, fraction: { singular: 'PAISE', plural: 'PAISE' } }
    };
    return currencies[currency] || currencies.USD;
}

function convertWholeNumber(numStr) {
    const num = parseInt(numStr);
    if (isNaN(num)) return '';
    if (num === 0) return '';
    
    const units = ['', 'ONE', 'TWO', 'THREE', 'FOUR', 'FIVE', 'SIX', 'SEVEN', 'EIGHT', 'NINE'];
    const teens = ['TEN', 'ELEVEN', 'TWELVE', 'THIRTEEN', 'FOURTEEN', 'FIFTEEN', 'SIXTEEN', 'SEVENTEEN', 'EIGHTEEN', 'NINETEEN'];
    const tens = ['', '', 'TWENTY', 'THIRTY', 'FORTY', 'FIFTY', 'SIXTY', 'SEVENTY', 'EIGHTY', 'NINETY'];
    const scales = ['', 'THOUSAND', 'MILLION', 'BILLION'];
    
    if (num < 10) return units[num];
    if (num < 20) return teens[num - 10];
    if (num < 100) {
        const ten = Math.floor(num / 10);
        const unit = num % 10;
        return tens[ten] + (unit ? '-' + units[unit] : '');
    }
    
    if (num < 1000) {
        const hundred = Math.floor(num / 100);
        const remainder = num % 100;
        return units[hundred] + ' HUNDRED' + (remainder ? ' AND ' + convertWholeNumber(remainder.toString()) : '');
    }
    
    for (let i = 0; i < scales.length; i++) {
        const scaleValue = Math.pow(1000, i+1);
        if (num < scaleValue) {
            const scale = Math.floor(num / Math.pow(1000, i));
            const remainder = num % Math.pow(1000, i);
            return convertWholeNumber(scale.toString()) + ' ' + scales[i] + (remainder ? ' ' + convertWholeNumber(remainder.toString()) : '');
        }
    }
    
    return '';
}

// Export functionality
function showExport() {
    trackUserAction('export_panel_opened');
    document.getElementById('exportContainer').classList.add('show');
}

function hideExport() {
    document.getElementById('exportContainer').classList.remove('show');
}

function exportResults() {
    trackUserAction('results_exported');
    
    const exportFormat = document.querySelector('input[name="exportFormat"]:checked').value;
    const includeDate90 = document.getElementById('exportDate90').checked;
    const includeFinalDate = document.getElementById('exportFinalDate').checked;
    const includeNumberWords = document.getElementById('exportNumberWords').checked;
    const includeInputData = document.getElementById('exportInputData').checked;
    
    let content = 'LC Date Calculator Pro - Results\n';
    content += '===============================\n\n';
    
    if (includeInputData) {
        content += `INPUT DATA:\n`;
        content += `- LC Issuance Date: ${document.getElementById('inputDate').value || 'Not set'}\n`;
        content += `- Days to Subtract: ${document.getElementById('subDays').value || '0'}\n`;
        content += `- Amount: ${document.getElementById('numberInput').value || 'Not set'}\n`;
        content += `- Currency: ${document.getElementById('currencySelect').value}\n\n`;
    }
    
    if (includeDate90 && !document.getElementById('date90Card').classList.contains('opacity-hidden')) {
        content += `90-Day Expiry Date: ${document.getElementById('date90').textContent}\n`;
    }
    
    if (includeFinalDate && !document.getElementById('finalDateCard').classList.contains('opacity-hidden')) {
        content += `Latest Shipment Date: ${document.getElementById('finalDate').textContent}\n`;
    }
    
    if (includeNumberWords && !document.getElementById('wordsOutputCard').classList.contains('opacity-hidden')) {
        content += `Amount in Words: ${document.getElementById('wordsOutput').textContent}\n`;
    }
    
    content += `\nGenerated on: ${new Date().toLocaleString()}\n`;
    content += `Tool: LC Date Calculator Pro by Sethil\n`;
    
    if (exportFormat === 'text') {
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'lc-calculation-results.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showNotification('Results exported successfully!');
    } else if (exportFormat === 'print') {
        const printWindow = window.open('', '_blank');
        printWindow.document.write('<pre>' + content + '</pre>');
        printWindow.document.close();
        printWindow.print();
        showNotification('Print preview opened');
    }
    
    hideExport();
}

// Game functionality
function showGame() {
    trackUserAction('game_opened');
    document.getElementById('gameContainer').classList.add('show');
}

function hideGame() {
    document.getElementById('gameContainer').classList.remove('show');
}

let gameRunning = false;
let gameScore = 0;
let highScore = 0;

function startGame() {
    gameRunning = true;
    gameScore = 0;
    document.getElementById('scoreValue').textContent = gameScore;
    showNotification('Game started! Use arrow keys to play.');
}

function pauseGame() {
    gameRunning = !gameRunning;
    showNotification(gameRunning ? 'Game resumed' : 'Game paused');
}

// Initialize
window.onload = function() {
    checkLogin();
    detectSystemTheme();
    
    // Set today's date as default
    const today = new Date();
    const formattedDate = today.toISOString().substring(0, 10);
    document.getElementById('inputDate').value = formattedDate;
    
    // Initialize with default calculation
    calculateAll();
};
</script>
</body>
</html>
