<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - All Users Tracking</title>
    <style>
        :root {
            --bg: linear-gradient(135deg, #121212 0%, #1a1a2e 50%, #16213e 100%);
            --text: #f8f9fa;
            --card: rgba(30, 30, 46, 0.85);
            --primary: #6c5ce7;
            --secondary: #00cec9;
            --accent: #fd79a8;
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .login-container {
            background: var(--card);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            width: 90%;
            max-width: 400px;
            margin: 100px auto;
            border: 1px solid rgba(108, 92, 231, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(108, 92, 231, 0.3);
            backdrop-filter: blur(10px);
            display: none;
        }
        
        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 30px;
        }
        
        h2 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 20px;
        }
        
        input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid rgba(108, 92, 231, 0.3);
            border-radius: 12px;
            background: rgba(42, 42, 62, 0.7);
            color: var(--text);
            font-size: 16px;
            box-sizing: border-box;
        }
        
        input:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        button {
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #5b4cd6;
            transform: translateY(-2px);
        }
        
        .full-width {
            width: 100%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(42, 42, 62, 0.7);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid var(--primary);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .data-section {
            margin-bottom: 30px;
            background: rgba(42, 42, 62, 0.3);
            padding: 20px;
            border-radius: 12px;
        }
        
        .data-section h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 5px;
        }
        
        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .user-table th, .user-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .user-table th {
            background: rgba(108, 92, 231, 0.3);
            color: var(--primary);
            position: sticky;
            top: 0;
        }
        
        .user-table tr:hover {
            background: rgba(108, 92, 231, 0.1);
        }
        
        .device-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin: 2px;
        }
        
        .mobile-badge {
            background: #00cec9;
            color: white;
        }
        
        .desktop-badge {
            background: #6c5ce7;
            color: white;
        }
        
        .tablet-badge {
            background: #fd79a8;
            color: white;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(42, 42, 62, 0.3);
            border-radius: 12px;
        }
        
        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            z-index: 1000;
        }
        
        .error-message {
            color: #ff6b6b;
            margin-top: 10px;
            display: none;
        }
        
        .search-box {
            margin: 20px 0;
            padding: 15px;
            background: rgba(42, 42, 62, 0.5);
            border-radius: 10px;
        }
        
        .search-box input {
            margin: 0;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 10px;
        }
        
        .page-btn {
            padding: 8px 15px;
            background: rgba(108, 92, 231, 0.3);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: var(--text);
        }
        
        .page-btn.active {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Login Section -->
    <div class="login-container" id="loginContainer">
        <h2>üîê Admin Login</h2>
        <p>Enter admin password to access ALL users tracking data</p>
        <input type="password" id="adminPassword" placeholder="Enter admin password">
        <button class="full-width" onclick="loginAdmin()">Login</button>
        <div class="error-message" id="errorMessage">Invalid password! Try again.</div>
        <div style="margin-top: 20px;">
            <button class="btn full-width" onclick="window.location.href='main.html'" style="background: #666;">‚Üê Back to App</button>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="admin-container" id="adminContainer">
        <button class="logout-btn" onclick="logoutAdmin()">üö™ Logout</button>
        
        <h1>üîç ALL USERS TRACKING DASHBOARD</h1>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="totalUsers">0</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalPageViews">0</div>
                <div class="stat-label">Total Page Views</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalActions">0</div>
                <div class="stat-label">User Actions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="mobileUsers">0</div>
                <div class="stat-label">Mobile Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeToday">0</div>
                <div class="stat-label">Active Today</div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="refreshData()">üîÑ Refresh Data</button>
            <button class="btn btn-accent" onclick="exportAllData()">üì• Export All Data</button>
            <button class="btn" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
            <button class="btn" onclick="showSystemInfo()">üîß System Info</button>
        </div>

        <div class="data-section">
            <h3>üë• ALL USERS ({allUsers.length})</h3>
            <div class="search-box">
                <input type="text" id="userSearch" placeholder="Search users by name..." onkeyup="filterUsers()">
            </div>
            <div id="usersTableContainer">Loading users...</div>
            <div class="pagination" id="pagination"></div>
        </div>
        
        <div class="data-section">
            <h3>üìä RECENT ACTIVITY</h3>
            <div id="recentActivity">Loading recent activity...</div>
        </div>
        
        <div class="data-section">
            <h3>üìà USER STATISTICS</h3>
            <div id="userStats">Loading statistics...</div>
        </div>
    </div>

    <script>
        // Admin password - CHANGE THIS
        const ADMIN_PASSWORD = "admin123";
        let currentPage = 1;
        const usersPerPage = 10;
        let allUsersData = [];
        
        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            const errorMessage = document.getElementById('errorMessage');
            
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContainer').style.display = 'block';
                loadAllData();
                console.log('üîê ADMIN LOGIN: Access to ALL users data');
            } else {
                errorMessage.style.display = 'block';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }
        
        function logoutAdmin() {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('adminContainer').style.display = 'none';
            document.getElementById('adminPassword').value = '';
            document.getElementById('errorMessage').style.display = 'none';
        }
        
        function loadAllData() {
            loadUsersTable();
            loadStatistics();
            loadRecentActivity();
        }
        
        function loadUsersTable() {
            allUsersData = JSON.parse(localStorage.getItem('allUsers') || '[]');
            const allPageViews = JSON.parse(localStorage.getItem('allPageViews') || '[]');
            const allUserActions = JSON.parse(localStorage.getItem('allUserActions') || '[]');
            
            // Sort users by last activity (newest first)
            allUsersData.sort((a, b) => new Date(b.lastActivity || b.loginTime) - new Date(a.lastActivity || a.loginTime));
            
            // Calculate user stats
            allUsersData.forEach(user => {
                user.pageViews = allPageViews.filter(pv => pv.userId === user.id).length;
                user.actions = allUserActions.filter(action => action.userId === user.id).length;
                user.lastSeen = user.lastActivity || user.loginTime;
            });
            
            displayUsersTable(allUsersData);
            updateStats(allUsersData, allPageViews, allUserActions);
        }
        
        function displayUsersTable(users) {
            const startIndex = (currentPage - 1) * usersPerPage;
            const endIndex = startIndex + usersPerPage;
            const usersToShow = users.slice(startIndex, endIndex);
            
            let tableHTML = `
                <table class="user-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>User Name</th>
                            <th>Device</th>
                            <th>First Seen</th>
                            <th>Last Activity</th>
                            <th>Logins</th>
                            <th>Page Views</th>
                            <th>Actions</th>
                            <th>Platform</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            if (usersToShow.length === 0) {
                tableHTML += `<tr><td colspan="9" style="text-align: center;">No users found</td></tr>`;
            } else {
                usersToShow.forEach((user, index) => {
                    const globalIndex = startIndex + index + 1;
                    tableHTML += `
                        <tr>
                            <td>${globalIndex}</td>
                            <td><strong>${user.name}</strong></td>
                            <td>${getDeviceBadge(user.deviceType)}</td>
                            <td>${formatDate(user.firstSeen || user.loginTime)}</td>
                            <td>${formatDate(user.lastSeen)}</td>
                            <td>${user.loginCount || 1}</td>
                            <td>${user.pageViews || 0}</td>
                            <td>${user.actions || 0}</td>
                            <td>${user.platform || 'Unknown'}</td>
                        </tr>
                    `;
                });
            }
            
            tableHTML += `</tbody></table>`;
            
            document.getElementById('usersTableContainer').innerHTML = tableHTML;
            createPagination(users.length);
        }
        
        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const filteredUsers = allUsersData.filter(user => 
                user.name.toLowerCase().includes(searchTerm)
            );
            currentPage = 1;
            displayUsersTable(filteredUsers);
        }
        
        function createPagination(totalUsers) {
            const totalPages = Math.ceil(totalUsers / usersPerPage);
            let paginationHTML = '';
            
            for (let i = 1; i <= totalPages; i++) {
                paginationHTML += `
                    <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">
                        ${i}
                    </button>
                `;
            }
            
            document.getElementById('pagination').innerHTML = paginationHTML;
        }
        
        function goToPage(page) {
            currentPage = page;
            displayUsersTable(allUsersData);
        }
        
        function loadRecentActivity() {
            const allPageViews = JSON.parse(localStorage.getItem('allPageViews') || '[]');
            const allUserActions = JSON.parse(localStorage.getItem('allUserActions') || '[]');
            
            // Combine and sort by timestamp
            const allActivities = [
                ...allPageViews.map(pv => ({...pv, type: 'page_view'})),
                ...allUserActions.map(action => ({...action, type: 'user_action'}))
            ].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 20);
            
            let activityHTML = '<table class="user-table"><thead><tr><th>Time</th><th>User</th><th>Activity</th><th>Type</th></tr></thead><tbody>';
            
            allActivities.forEach(activity => {
                activityHTML += `
                    <tr>
                        <td>${formatTime(activity.timestamp)}</td>
                        <td>${activity.userName}</td>
                        <td>${activity.type === 'page_view' ? `Visited ${activity.page}` : activity.action}</td>
                        <td>${activity.type === 'page_view' ? 'üìÑ Page' : 'üéØ Action'}</td>
                    </tr>
                `;
            });
            
            activityHTML += '</tbody></table>';
            document.getElementById('recentActivity').innerHTML = activityHTML;
        }
        
        function loadStatistics() {
            const allUsers = JSON.parse(localStorage.getItem('allUsers') || '[]');
            const allPageViews = JSON.parse(localStorage.getItem('allPageViews') || '[]');
            const allUserActions = JSON.parse(localStorage.getItem('allUserActions') || '[]');
            
            const stats = {
                totalUsers: allUsers.length,
                totalPageViews: allPageViews.length,
                totalActions: allUserActions.length,
                mobileUsers: allUsers.filter(user => user.isMobile).length,
                activeToday: allUsers.filter(user => isToday(user.lastActivity || user.loginTime)).length,
                popularDevices: calculatePopularDevices(allUsers),
                popularActions: calculatePopularActions(allUserActions),
                userGrowth: calculateUserGrowth(allUsers)
            };
            
            let statsHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div><strong>Total Unique Users:</strong> ${stats.totalUsers}</div>
                    <div><strong>Mobile Users:</strong> ${stats.mobileUsers}</div>
                    <div><strong>Active Today:</strong> ${stats.activeToday}</div>
                    <div><strong>Total Page Views:</strong> ${stats.totalPageViews}</div>
                    <div><strong>Total User Actions:</strong> ${stats.totalActions}</div>
                </div>
            `;
            
            document.getElementById('userStats').innerHTML = statsHTML;
        }
        
        function updateStats(users, pageViews, actions) {
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalPageViews').textContent = pageViews.length;
            document.getElementById('totalActions').textContent = actions.length;
            document.getElementById('mobileUsers').textContent = users.filter(user => user.isMobile).length;
            document.getElementById('activeToday').textContent = users.filter(user => isToday(user.lastActivity || user.loginTime)).length;
        }
        
        function calculatePopularDevices(users) {
            const deviceCounts = {};
            users.forEach(user => {
                deviceCounts[user.deviceType] = (deviceCounts[user.deviceType] || 0) + 1;
            });
            return deviceCounts;
        }
        
        function calculatePopularActions(actions) {
            const actionCounts = {};
            actions.forEach(action => {
                actionCounts[action.action] = (actionCounts[action.action] || 0) + 1;
            });
            return actionCounts;
        }
        
        function calculateUserGrowth(users) {
            const today = new Date().toDateString();
            return users.filter(user => new Date(user.firstSeen || user.loginTime).toDateString() === today).length;
        }
        
        function isToday(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }
        
        function getDeviceBadge(deviceType) {
            const type = (deviceType || 'desktop').toLowerCase();
            if (type.includes('mobile')) {
                return '<span class="device-badge mobile-badge">üì± Mobile</span>';
            } else if (type.includes('tablet')) {
                return '<span class="device-badge tablet-badge">üìü Tablet</span>';
            } else {
                return '<span class="device-badge desktop-badge">üíª Desktop</span>';
            }
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        function refreshData() {
            loadAllData();
            alert('Data refreshed!');
        }
        
        function exportAllData() {
            const allData = {
                users: JSON.parse(localStorage.getItem('allUsers') || '[]'),
                pageViews: JSON.parse(localStorage.getItem('allPageViews') || '[]'),
                userActions: JSON.parse(localStorage.getItem('allUserActions') || '[]'),
                exportTime: new Date().toISOString(),
                totalRecords: {
                    users: JSON.parse(localStorage.getItem('allUsers') || '[]').length,
                    pageViews: JSON.parse(localStorage.getItem('allPageViews') || '[]').length,
                    actions: JSON.parse(localStorage.getItem('allUserActions') || '[]').length
                }
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `all-users-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('All users data exported successfully!');
        }
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è WARNING: This will delete ALL users data permanently! Are you sure?')) {
                localStorage.removeItem('allUsers');
                localStorage.removeItem('allPageViews');
                localStorage.removeItem('allUserActions');
                loadAllData();
                alert('All data cleared!');
            }
        }
        
        function showSystemInfo() {
            const systemInfo = {
                totalUsers: JSON.parse(localStorage.getItem('allUsers') || '[]').length,
                totalPageViews: JSON.parse(localStorage.getItem('allPageViews') || '[]').length,
                totalActions: JSON.parse(localStorage.getItem('allUserActions') || '[]').length,
                storageUsage: calculateStorageUsage(),
                lastUpdated: new Date().toLocaleString()
            };
            
            console.log('üîß SYSTEM INFO:', systemInfo);
            alert('System info logged to console (F12)');
        }
        
        function calculateStorageUsage() {
            let total = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    total += localStorage[key].length * 2; // UTF-16 characters use 2 bytes
                }
            }
            return (total / 1024).toFixed(2) + ' KB';
        }
        
        // Enter key support for login
        document.getElementById('adminPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loginAdmin();
            }
        });
        
        // Focus on password input when page loads
        window.onload = function() {
            document.getElementById('adminPassword').focus();
        };
    </script>
</body>
</html>
